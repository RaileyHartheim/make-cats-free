## Объяснение решений

### Стейкхолдеры и с чем их едят
Итак, начнем...

![Who's that?](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-03/stakeholders.jpg?raw=true)

#### Вспомним, чьи консёрны нам удалось получить:
- **топ-менеджмент** — можем предположить, что это top of the top менеджеров, возможно, отнесем сюда и оунеров. Влияние высокое, интерес выше среднего.
- **менеджеры** — поскольку не было уточнений, что это какой-то специфический вид менеджеров, то наверняка сюда можно отнести:
	- HR-менеджеров
	- менеджеров отдела расходников (там все менеджеры или как?)
	- менеджеров из отдела оценки качества работы
	- менеджеров по внедрению услуг (заведению услуг? управлению услугами? ну вы понели)
	Влияние выше среднего, интерес высокий.
- **финотдел** — интерес средний или около того, влияние выше среднего
- **разработчики** — будем относить к ним тестировщиков (которые не коты), дизайнеров и проджект-менеджеров (или кто там будет разработкой управлять)? Влияние среднее, интерес высокий.
- **админы** — влияние выше среднего, интерес не очень.
- **юристы** — влияние среднее, интерес ниже среднего.
- **клиенты** — подозреваю, что здесь у нас как коты-тестировщики (и другие заказчики услуг в будущем), так и воркеры. Влияние низкое, зато интерес высокий.
#### Кого забыли?
- если **отдел расходников** состоит не только из менеджеров, то тогда **обычные работники** этого отдела
- если рассмотрением гипотез занимается не отдел оценки качества работы, тогда тот, кто этим занимается (условные **датасайентисты**)
- если к разработчикам отнесем только разработчиков, то убираем детализацию из предыдущего пункта и думаем, что забыли про **тестировщиков** (которые все еще не коты), **дизайнеров** и прочих тесно связанных с разработкой **не-разработчиков**
- **Золотая шляпа** как внешняя система?
- **Подрядчик, готовящий fur-tune-печенье**, как еще одна внешняя система?

#### Строим матрицу "Влияние — Интерес"

![Здесь должна быть матрица](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-03/power-interest-03.png?raw=true)

#### Не забываем зафиксировать консёрны

| ID  | Стейкхолдер    | Консёрны                                                                                                                                                                                                                                                     |
| --- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1   | Топ-менеджмент | • хотим в дальнейшем продавать скоринг работников как продукт<br>• хотим тестировать больше гипотез<br>• хотим установить релизный цикл для всей системы длиной в месяц<br>• а для скоринга работников — длиной в неделю                                     |
| 2   | Менеджеры      | • хотим, чтобы начальство и другие отделы не знали про систему ставок<br>• хотим, чтобы система приема заявок была способна масштабироваться                                                                                                                 |
| 3   | Финотдел       | • хотим, чтобы информация была надежно защищена<br>• хотим списывать деньги с клиентов с меньшей периодичностью (раз в месяц)<br>• хотим платить воркерам не чаще раза в месяц<br>• хотим иметь возможность постоянно добавлять новые способы списания денег |
| 4   | Разработчики   | • хотим, чтобы система работала без сбоев<br>• хотим, чтобы было понятно, что и где чинить, если без сбоев не получилось                                                                                                                                     |
| 5   | Админы         | • хотим, чтобы систему можно было легко мониторить                                                                                                                                                                                                           |
| 6   | Юристы         | • хотим, чтобы вся система соответствовала правовым нормам                                                                                                                                                                                                   |
| 7   | Клиенты        | • хотим ожидаемое поведение системы: без тупняков и сбоев                                                                                                                                                                                                    |
### Архитектурный стиль

#### Вспоминаем итоговую структуру

![hello again](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-03/hello-again.jpg?raw=true)

В конце прошлой домашки мы получили приблизительно следующую итоговую структуру, но на всякий случай перекрасили все получившиеся поддомены в цвета Core Domain Chart, что мы не сделали в прошлый раз, и подписали их своими названиями (но это ненадолго, по ходу дела их еще раз переименуем):

![Перекрашенные поддомены из прошлой домашки](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-03/subdomains-03.png?raw=true)

❗️ Примечание: в дальнейшем превращаем:
-  поддомен"Отбор воркеров" в "Поиск лучших работников"
- контекст "Отбор воркеров" в "Скоринг"
- поддомен "Матчинг воркеров под услуги"" в "Подбор лучшего обычного образца для выполнения услуг"
- поддомен "Оценка качества работы" в "Контроль качества работы"
- поддомен "Снабжение расходниками" в "Ускорение выполнения работ"
- поддомен "Управление ставками" в "Повышение мотивации менеджеров"
- контекст "Управление ставками" в "Система ставок"
#### Обновляем список характеристик

В предыдущей домашке мы выделяли характеристики на основе бизнес-требований. Добавим к ним следующие характеристики на основе консёрнов, которые были не охвачены в прошлый раз или требуют еще большего внимания:
- алгоритм скоринга стал сложнее (теоретически сложность может увеличиться): **evolvability**
- система должна быть максимально во власти компании — это касается как данных, так и кода. Сохранность данных я уже подчеркивала в прошлой домашке, так что: +100500 к **security**
- к требованию низкого TTM добавили релизный цикл — неделя для скоринга и месяц для всей остальной системы: +100500 к **agility**, **deployability**, **testability**
- заказов приходит больше, чем ожидалось (но мы ожидали): **scalability**, **evolvability**
- финотдел хочет добавлять новые способы списания для клиентов: **modifiability**
- менеджеры не хотят, чтобы о системе ставок знали другие отделы, руководство и часть разработчиков, юристы хотят соблюдения правовых норм: ~~isolirity~~  **изолированность**, **соблюдение правовых норм**

И не забываем про внешнее ограничение в виде CatFinComplience: **consistence**, **reliability**, **security**

Отобразим, на какие характеристики должны обратить пристальное внимание для того или иного поддомена/контекста.

![И снова стикеры!](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-03/characteristics-03.png?raw=true)


#### И переделываем итоговую структуру

Как видим, у наших контекстов есть общие характеристики, но некоторые контексты выделяются своими характеристиками:
- **скоринг**: релизный цикл в неделю, high model complexity, специфика core-поддомена. Однозначно выделяем в отдельный сервис.
- **матчинг**: high model complexity, специфика core-поддомена, изолированность. Последнее как бы само намекает, что матчинг надо выделить в отдельный сервис.
- **расчеты с клиентами и воркерами**: reliability, особое внимание к security (платежные данные, как-никак), вот это вот всё. Надо 
	1) отделить от поддомена заказа и выполнения услуг
	2)  разделить на два сервиса: один для расчетов с клиентами (нужно больше modifiability), другой — для расчетов с воркерами. Да и чтобы не путаться в инвойсах, учитывать способы оплаты в одном случае.
- **система ставок**: изолированность, соблюдение правовых норм. Однозначно отделять, отдать на разработку отдельному разработчику, перед остальными не светить.

На всякий случай отображу еще некоторые внешние системы:
- я отображала перенос данных о котах-тестировщиках из Happy Cat Box ранее, но здесь покажу это внешней системой (условно)
- отдельно выделю и поставщика печенья (печенье все-таки нужно для повышения лояльности клиентов, а не для ускорения выполнения заказов)
- Золотую шляпу тоже отображу как внешнюю систему

Если переделать структуру с учетом всего вышенаписанного, то получится следующая картина (зеленым выделены наши сервисы, серым — внешние):

![Ну теперь-то итоговая?..](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-03/final-structure-correct-now-03.png?raw=true)

Похоже, что и в этот раз выберем микросервисы — для всей системы в целом.

Обновленный Event Storming закину, как только найдется время его обновить...

![каневский.жпг](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-03/kanevsky.png?raw=true)

#### Определим стили для каждого из сервисов

Предположу, что для **скоринга** можно выбрать Microkernel: за счет modifiability и maintainability, а также, возможно, configurability + testability и deployability. Reliability и security тоже вполне себе на уровне.

Для матчинга я бы скорее выбрала Pipeline, поскольку по краткому описанию алгоритм — набор шагов, на основе которых рассчитываются рейтинги и прочее. Будет легче добавлять шаги при необходимости.

Для всего остального ~~есть Mastercard~~ можно попробовать обойтись Layered Monolith.

Что по поводу баз данных? Пожалуй, возьмем реляционные БД для каждого отдельного сервиса (особенно для расчетов это важно из-за комплаенса), но есть сомнения по поводу скоринга и матчинга.

| Сервис                         | Архитектурный стиль | Вид базы данных |
| ------------------------------ | ------------------- | --------------- |
| Скоринг                        | Microkernel         | Реляционная БД  |
| Матчинг                        | Pipeline            | Реляционная БД  |
| Заказ и выполнение услуг       | Layered monolith    | Реляционная БД  |
| Ускорение выполнения работ     | Layered monolith    | Реляционная БД  |
| Расчеты с клиентами            | Layered monolith    | Реляционная БД  |
| Расчеты с исполнителями        | Layered monolith    | Реляционная БД  |
| Контроль качества работы       | Layered monolith    | Реляционная БД  |
| Повышение мотивации менеджеров | Layered monolith    | Реляционная БД  |

### Коммуникации

Не успеваю сделать схему коммуникаций, так что словами:
- асинхронная коммуникация от сервиса скоринга к сервисам матчинга и оказания услуг: стримминг данных о новом воркере
- асинхронная коммуникация от HCB к сервису оформления и отслеживания заказов: стримминг данных о новом клиенте-тестировщике
- асинхронная коммуникация между сервисами матчинга и оформления и отслеживания заказов: бизнес-событие "заказ создан" от сервиса оформления заказов и стримминг результатов матчинга от сервиса матчинга
- асинхронная коммуникация между сервисами матчинга и выполнения работ: стримиинг данных о новом назначении воркера на заказ
- синхронная коммуникация от снабжения расходниками к поставщику печенья: бизнес-событие "нужно доставить печенье"
- асинхронная коммуникация от сервиса оформления и отслеживания заказов к сервису расчетов с клиентами: стримминг данных о заказах клиентов
- асинхронная коммуникация от сервиса выполнения работ к сервису расчетов с воркерами: стримминг данных о заказах клиентов, статусе выполненных работ
- асинхронная коммуникация от сервисов расчетов с клиентами и воркерами к "Золотой шляпе": стримминг данных о выставлении счетов и выплатах воркерам
- асинхронная коммуникация от сервиса оформления и отслеживания заказов к сервису оценки качества: стримминг данных о заказах
- асинхронная коммуникация от сервиса оформления и отслеживания заказов к сервису системы ставок: стримминг данных о заказах, бизнес-события "заказ выполнен", "заказ провален"

### Фитнес-функции
- Общие для всех:
	- проверка покрытия тестами не ниже 80%
	- проверка периодичности релизов не реже раза в месяц
- Скоринг
	- проверка периодичности релизов не реже раза в неделю
	- анализ метрик coupling и cohesion
	- прохождение нагрузочных тестов scalability и elasticity
- Матчинг
	- анализ метрик coupling и cohesion
	- обратная связь от клиентов и контроля качества?
- Заказ и выполнение услуг
	- прохождение нагрузочных тестов scalability и elasticity

### ADR

**ADR-001. Сервис скоринга потенциальных воркеров**

**Status**: proposed

**Context**:  Основываясь на требованиях и консёрнах стейкхолдеров, мы выделили следующие моменты, касающиеся сервиса скоринга:
- скоринг предполагается как одно из двух конкурентных преимуществ, из-за чего его стоит отнести к core-поддоменам
- сложность модели высока и может стать еще выше
- в будущем планируется продавать его другим компаниям и тестировать больше гипотез
- для него установлен особый релизный цикл —длиной в неделю (для всей остальной системы — длиной в месяц)
- ожидается 1k заявок в день от кандидатов в воркеры
- есть подозрения, что могут заддосить конкуренты
- менеджеры должны иметь возможность конфигурировать набор тестов под каждого отдельного кота или вакансию котов
- получаем и храним персональную информацию о воркерах (полагаю, что и о кандидатах тоже)

Дополнительные ограничения:
- по части инфраструктуры нас ничто не ограничивает (считаем бесплатной)
- надо соблюдать CatFinComplience, который говорит об особом способе хранения данных и особой наблюдаемости за системой.

**Decision**: Скоринг необходимо выделить как отдельный сервис по следующим причинам:
- планируется в дальнейшем продавать его как отдельный продукт
- релизный цикл для скоринга значительно отличается от релизного цикла для все остальной системы
- много заявок — потенциально большая нагрузка, надо обособить от других сервисов, чтобы избежать их падения в случае чего

Предложено реализовать скоринг как Microkernel с собственной реляционной базой данных.

**Consequences**: Выделим следующие плюсы и минусы выделения скоринга как отдельного сервиса:

➕ в случае падения сервиса работа других сервисов пострадать не должна;

➕ проще соблюдать релизный цикл сервиса

➕ можно будет продать как продукт другим компаниям

➖ усложняется коммуникация с другими сервисами

**Compliance**: Проверку принятого решения стоит осуществлять с помощью:
- покрытия тестами
- проверки частоты релизов
- нагрузочных тестов
