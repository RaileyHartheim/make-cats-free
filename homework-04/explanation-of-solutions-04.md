## Объяснение решений
❗️Disclaimer: есть подозрения, что я по ходу дела всё равно что-то упустила, так что будьте милосердны при проверке, онегай~ (º人º)

### Что было...
Поскольку нулевую домашку я сделать не успела, обратимся к первой домашке.
Выяснилось, что смотреть на первоначальную версию приложения довольно сложно (глазам больно).
В целом получилось что-то вроде этого:

![first-final-structure.png](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-04/first-final-structure-04.png?raw=true)

Вспомним, как рассчитывается Instability:

```math
Instability = \frac{Ce}{(Ce + Ca)}, 
```
где Ce — количество исходящих связей элемента, Ca — количество входящих связей элемента.

И вроде бы при расчете должно получиться следующее:

| Сервис             | Входящие связи | Исходящие связи | Instability |
| ------------------ | -------------- | --------------- | ----------- |
| HR                 | 0              | 1               | 1           |
| Мегамонолит        | 2              | 2               | 0.5         |
| Подбор расходников | 1              | 1               | 0.5         |
| Проведение ставок  | 1              | 0               | 0           |

Только вот после выделения характеристик есть подозрения, что при росте нагрузки монолитище с оформлением заказов, биллингом и всем прочим где-нибудь да рухнет.

### Чем стало...
Вспоминаем, на чем мы остановились в прошлой домашке. Кажется, там было что-то такое:

![third-final-structure.png](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-04/third-final-structure-04.png?raw=true)

Посчитаем instability для сервисов:

| Сервис                                                  | Входящие связи | Исходящие связи | Instability |
| ------------------------------------------------------- | -------------- | --------------- | ----------- |
| Отбор воркеров (ex-HR)                                  | 0              | 1               | 1           |
| Матчинг                                                 | 2              | 1               | ~0.33       |
| Заказ и выполнение услуг                                | 2              | 5               | ~0.71       |
| Ускорение выполнения работ (сборка расходников)         | 1              | 2               | ~0.67       |
| Контроль качества работы                                | 1              | 0               | 0           |
| Расчеты с клиентами                                     | 1              | 1               | 0.5         |
| Расчеты с исполнителями                                 | 1              | 1               | 0.5         |
| Повышение мотивации менеджеров (ex-управление ставками) | 1              | 0               | 0           |

❗️Стоит учесть. что в первой домашке не были указаны внешние системы: перенос данных о тестировщиках из НСВ, поставщик fur-tune-печенья, Золотая ~~корона~~ шляпа. Не совсем сопоставимы показатели для "заказа и выполнения услуг", "расчетов с клиентами", "расчетов с исполнителями", "ускорения выполнения работ", потому что тогда instability для первой домашки примерно был бы следующим:

| Сервис             | Входящие связи | Исходящие связи | Instability | Что изменилось                                                  |
| ------------------ | -------------- | --------------- | ----------- | --------------------------------------------------------------- |
| HR                 | 0              | 1               | 1           |                                                                 |
| Мегамонолит        | 3              | 4               | 0.57        | +1 входящая связь от HCB<br>+ 2 исходящие связи к Золотой шляпе |
| Подбор расходников | 1              | 2               | ~0.67       | + 1 исходящая связь к поставщику печенья                        |
| Проведение ставок  | 1              | 0               | 0           |                                                                 |

### Массовые распилы
![splitting.png](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-04/splitting.png?raw=true)

Определимся с тем, что нужно сделать:
- перепишем отбор воркеров из монолита в microkernel из-за требований в прошлой домашке. Вид БД не меняется, модель данных вроде бы тоже, но алгоритмы придется переписать... Подозреваю, что стоит применить **Change Data Capture**.
- вынесем матчинг из мегамонолита с заказами (core-поддомен, требуются scalability и изолированность), снизим instability и перепишем с монолита на pipeline. Вид БД не меняется, но вроде как меняется модель данных? Можно тогда попробовать применить **Change Data Capture**
-  оттуда же вынесем биллинг и разделим его надвое: расчеты с клиентами и расчеты с исполнителями (комплаенс, необходимость внедрять новые способы оплаты для клиентов, да и все-таки инвойс для клиента и инвойс для исполнителя – штуки разные, надо не запутаться). Выберем **Tactical Forking**
-  вынесем отдельно и контроль качества работы (для него вроде нет такой необходимости в scalability и evolvability, как для оставшихся частей монолита), тоже воспользуемся **Tactical Forking**
- распилим контекст "создание заказов" оттуда же надвое — в "Оформление и отслеживание заказов" и "Выполнение работ", разделим логику для клиента и исполнителя, но выделять что-то в новый сервис не будем.


В случае "**есть люди и ресурсы, нет опыта и/или инфраструктуры**" порядок будет такой:
- первым делом вынесем **контроль качества работы** как вообще самую простую часть системы в отдельный сервис
- разделим надвое **биллинг** и вынесем обе части в отдельные сервисы
- рефакторим **создание заказов**
- вынесем **матчинг** как контекст core-поддомена, к нему много требований, его нужно изолировать от остальных частей
- переписываем **отбор воркеров**, чтобы сменой стиля добиться нужных характеристик и выполнения требований

В случае "**нет людей и ресурсов, есть опыт и/или инфраструктура**":
- вынесем **матчинг** (core-поддомен, характеристики в рамках монолита не удовлетворены, требуют изолировать)
- разделим **биллинг** и вынесем (потому что комплаенс, интеграции с Золотой шляпой, хоть и менее рисково)
- переписываем **отбор воркеров** (да, core-домен, но позднее из-за предыдущего сервиса. да, спорный выбор)
- выносим **контроль качества работы**
- а потом можно уже и **создание заказов** порефакторить

### Постскриптум

Есть подозрения, что в прошлой домашке я не учла некоторые связи, так что финальная структура могла бы выглядеть так.

![third-updated-final-structure.png](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-04/third-upd-final-structure-04.png?raw=true)

| Сервис                                                  | Входящие связи | Исходящие связи | Instability |
| ------------------------------------------------------- | -------------- | --------------- | ----------- |
| Отбор воркеров (ex-HR)                                  | 0              | 1               | 1           |
| Матчинг                                                 | 2              | 2               | 0.5         |
| Заказ и выполнение услуг                                | 4              | 6               | 0.6         |
| Ускорение выполнения работ (сборка расходников)         | 1              | 2               | ~0.67       |
| Контроль качества работы                                | 1              | 0               | 0           |
| Расчеты с клиентами                                     | 1              | 1               | 0.5         |
| Расчеты с исполнителями                                 | 1              | 1               | 0.5         |
| Повышение мотивации менеджеров (ex-управление ставками) | 1              | 0               | 0           |

Вариант еще не окончательный, надо бы все-таки еще раз пересмотреть Event Storming и прикинуть варианты. Например, стоит ли объединить оформление/отслеживание заказов и выполнение работ в один контекст, подумать, правильно ли выделены связи между событиями из разных контекстов (есть сомнения, куда именно стоило отправлять данные о новом воркере). Но я подумаю об этом завтра.

![tomorrow.png](https://github.com/RaileyHartheim/make-cats-free/blob/main/homework-04/tomorrow.png?raw=true)
